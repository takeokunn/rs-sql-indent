WITH
    active_users AS (
    SELECT
        id,
        name
    FROM
        users
    WHERE
        active = TRUE
    )
SELECT
    u.id,
    u.name,
    o.total
FROM
    active_users u
JOIN orders o
    ON u.id = o.user_id
WHERE
    o.total > 100
ORDER BY
    o.total DESC